@*@{
        ViewBag.Title = "Index";
        // Layout = "~/Views/Shared/_Layout.cshtml";
    }*@
<!DOCTYPE html>
<html lang="en">
<head>
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryui")

    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/ImagesScroll")
    @*<script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
    <!-- Bootstrap Core CSS -->
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/design-sheet_chat.css" rel="stylesheet" />
    <link href="~/Content/bs_leftnavi.css" rel="stylesheet" />
    <link href="~/Content/media-q.css" rel="stylesheet" />
    <link href="~/Content/hover.css" rel="stylesheet" />
    <script src="~/Scripts/toastr.js"></script>
    <link href="~/Content/toastr.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="~/Content/simple-sidebar.css" rel="stylesheet" />
    <script src="~/Scripts/bs_leftnavi.js"></script>
    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
        }

        #wrapper {
            height: 100%;
        }

        .m-header {
            position: absolute;
            top: 0px;
            width: 100%;
        }
    </style>

    @*<script src="~/Scripts/jquery-1.10.2.js"></script>*@
    <script src="~/Scripts/angular.js"></script>
    <script src="~/CIRScripts/Common/AngularModule.js"></script>
    <script src="~/CIRScripts/Common/AngularService.js"></script>


    <link href="~/Scripts/Css/ChatStyle.css" rel="stylesheet" />
    <link href="~/Scripts/Css/JQueryUI/themes/base/jquery.ui.all.css" rel="stylesheet" />
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.1.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
        function fnLoadGif() {
            $("#divLoading").css("display", "block");
        }

        function fnRemoveGif() {
            $("#divLoading").css("display", "none");
        }

        function fnLoadGifMsg() {
            $("#divLoadingMsg").css("display", "block");
        }

        function fnRemoveGifMsg() {
            $("#divLoadingMsg").css("display", "none");
        }

        var fileval = "0";
        var Loginuid = "@ViewBag.Id";
        var files;

        var imgurl = "@System.Configuration.ConfigurationManager.AppSettings["AppUrl"].ToString()";
        var apiurl = imgurl + "/api/File/uploadfile";
        var imgg = "@System.Configuration.ConfigurationManager.AppSettings["ImagesIISUrl"].ToString()" + "Employee Profile Picture/";


        var profDefault = imgurl + "/Content/img/default-profile.png";
        var getattachurl = "@System.Configuration.ConfigurationManager.AppSettings["ImagesIISUrl"].ToString()" + "ChatFiles/";
        app.controller('Chat_OperController', function ($scope, CIR_OperationService, $interval) {
            $scope.OnlineuserArray="";

            $scope.imggupload = function () {
                $("#fuImage").click();
            }
            $scope.GetChatDataServer = function (view, ctrId) {
                //  $('#btnMsgP').css("display", "none");
                $scope.GetChatArray = "";
                var Data = {
                    toId: $("#Toid").val(),//$scope.ToId,
                    view: view
                }
                var promisePost = CIR_OperationService.postCommonService(GetChatUrl, Data);
                promisePost.then(function (pl) {
                    $scope.GetChatArray = pl.data.result;
                    var userId = $('#hdUserName').val();
                    $('#divMessage').html("");
                    // $('#divMessage').clearQueue();


                    if ($scope.GetChatArray != null) {

                        if ($scope.GetChatArray.length != null || $scope.GetChatArray.length != "" || $scope.GetChatArray.length != 0) {
                            // alert($scope.GetChatArray.length);

                            if (view == "1") {
                                   $('#btnMsgP').css("display", "none");
                            }
                            else {
                                if ($scope.GetChatArray.length > 49) {
                                      $('#btnMsgP').css("display", "block");
                                }
                                else {
                                      $('#btnMsgP').css("display", "none");
                                }

                            }
                            for (var i = 0; i < $scope.GetChatArray.length; i++) {
                                //start to bind chat message
                                var frmusername = $scope.GetChatArray[i].Name;
                                var frmuserId = $scope.GetChatArray[i].FromId;
                                var TouserId = $scope.GetChatArray[i].ToId;
                                var dbMsg = $scope.GetChatArray[i].Msg;
                                var dbAttach = $scope.GetChatArray[i].Attachment;
                                var dbProf = $scope.GetChatArray[i].EmpImage;
                                var dbSapCode = $scope.GetChatArray[i].SAPcode;

                                //   $("#Toid").val(TouserId);
                                // $("#Frmid").val(frmuserId);
                                if (dbProf == "" || dbProf == "0") {
                                    dbProf = profDefault;
                                }
                                else dbProf = imgg + dbProf;//  frmuserId + ".jpg""
                                if (userId == frmusername) {
                                    if (dbMsg != "") { // $('#' + ctrId).find('#divMessage')
                                        $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td align="right">' +
                                                                                   '<div class="chat-div-me"><p>' + dbMsg + '</p></div> </td> <td align="center" class="pro-pic">' +
                                                                                   '<img class="img-responsive img-circle"  src="' + dbProf + '"   onerror="this.src=' + "'" + profDefault + "'" + ';"   /></td> </tr></table> </div>');

                                    }
                                    else if (dbAttach != "0") {
                                        $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td align="right">' +
                                                                                       '<div class="chat-div-me"><a  target="_blank" style="cursor:pointer;" href="' + getattachurl + dbSapCode + "/" + dbAttach + '">' + dbAttach + '</a></div> </td> <td align="center" class="pro-pic">' +
                                                                                       '<img class="img-responsive img-circle"  src="' + dbProf + '"    onerror="this.src=' + "'" + profDefault + "'" + ';"  /></td> </tr></table> </div>');

                                    }

                                }
                                else {
                                    if (dbMsg != "") {
                                        $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td  class="pro-pic">' +
                                                                                    '<img class="img-responsive img-circle"  src="' + dbProf + '"   onerror="this.src=' + "'" + profDefault + "'" + ';"  /> </td> <td >' +
                                                                                    '<div class="chat-div"><p>' + dbMsg + '</p></div></td> </tr></table> </div>');


                                    }
                                    else if (dbAttach != "0") {
                                        $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td  class="pro-pic">' +
                                                                                       ' <img class="img-responsive img-circle"  src="' + dbProf + '"    onerror="this.src=' + "'" + profDefault + "'" + ';" />  </td> <td >' +
                                                                                       '<div class="chat-div"><a  target="_blank" style="cursor:pointer;" href="' + getattachurl + dbSapCode + "/" + dbAttach + '">' + dbAttach + '</a></div></td> </tr></table> </div>');
                                    }

                                }

                                //try {
                                var height = $("#divMessage").height();
                                $('div.chat-wrapper').scrollTop(height);
                                //}
                                //catch (err) { }
                                ////end to bind
                            }
                        }
                    }
                }, function (err) {
                    console.log("Error in saving the Field alert document details:" + err);
                });
            }
        
            $scope.FDataServer = function (view) {
                //if ($("#chatMsg").val() == "" ) {
                //    SetErrorMessage("Ensure msg!");

                //    return false;
                //}

                var Data = {
                    Id: "0",
                    FromId: $("#Frmid").val(),
                    ToId: $("#Toid").val(),//$scope.ToId,
                    Msg: "",//$("#chatMsg").val(), //$scope.Msg,
                    Attachment:"",// $("#chatAttach").val(),
                    MsgView: "1",
                    AttachView: "0",
                    Refid: "",
                    view:view,
                    Delflag: "0",
                    UsrDelflag: "0",
                    Name: ""
                }
                var promisePost = CIR_OperationService.postCommonService(SetChatUrl, Data);
                promisePost.then(function (pl) {
                    //$scope.Message = pl.data.result;

                    //if(view=="1"){}
                    //else{
                    //    //  alert('processing');
                    //    $scope.GetChatDataServer("0");
                    //}

                }, function (err) {
                    //   SetWarningMessage("Transaction Issue. Please try again.");
                    console.log("Error in saving the FDataServer details:" + err);
                });
            }
             
            $(function () {
                // Declare a proxy to reference the hub.
                var chatHub = $.connection.chatHub;
                var notifications = $.connection.notificationsHub;
                registerClientMethods(chatHub);

                // Start Hub
                $.connection.hub.start().done(function () {
                    registerEvents(chatHub)

                });

            });

            function registerEvents(chatHub) {

                var name = $("#txtNickName").val();
                if (name.length > 0) {
                    //  chatHub.server.connect(name);
                    chatHub.server.connect(name, Loginuid, "@ViewBag.Site", "@ViewBag.State", "@ViewBag.Title", "@ViewBag.ServerTime", "@ViewBag.DesgName", "1", "");

                }
                else {
                    //alert("Please login!");
                    window.location.href = "/";
                }

            }
            function registerClientMethods(chatHub) {
                

                $scope.GetOfflineUser = function (view) {
                    $scope.GetOfflineUserArray="";
                    var Data = {
                        SearchId:$("#hdnSearch").val(),
                        view: view//$scope.ToId,
                    }
                    var promisePost = CIR_OperationService.postCommonService(GetUserUrl,Data);
                    promisePost.then(function (pl) {
                        $scope.GetOfflineUserArray = pl.data.result;
                        $('#divusersOffline').html("");
                        usrArrayadd();
                    },
                    function (err) {
                        //   fnRemoveGif();
                        //  SetWarningMessage("Transaction Issue. Please try again.");
                        console.log("Error in saving the GetOfflineUser details:" + err);
                    });
                }

                // Calls when user successfully logged in
                chatHub.client.onConnected = function (id, userName, allUsers, messages) {
                    $('#hdId').val(id);
                    $('#hdUserName').val(userName);
                    $('#spanUser').html(userName);
                    // Add All Users
                    if(allUsers.length==1){
                        var code="";
                        code = $(' <li>' +                                         
                            '<div style="padding-top:15px;" id="no-group">'+
                                            '<p style="font-size:25px; margin:10px 0px 0px 0px; color:#3f606f;"></p>'+
                                            '<p>No online users.</p>'+
                                        '</div>'+
                                              '</li>');
                        $("#divusers").append(code);
                    }
                    else{
                        $scope.OnlineuserArray="";
                        $scope.OnlineuserArray=allUsers;
                        for (i = 0; i < allUsers.length; i++) {
                            AddUser(chatHub, allUsers[i].ConnectionId, allUsers[i].UserName, allUsers[i].UserNameId, allUsers[i].Sites, allUsers[i].States, allUsers[i].Img, allUsers[i].ServerTime, allUsers[i].Desg, allUsers[i].status, allUsers[i].PendingMSg);

                        }
                    }
                    
                    $scope.GetOfflineUser("1");
                }

                // On New User Connected
                chatHub.client.onNewUserConnected = function (id, name, UserNameId) {
                    $('#divusers').html("");
                    $scope.OnlineuserArray="";
                    $scope.OnlineuserArray=UserNameId;
                    for (i = 0; i < UserNameId.length; i++) {
                        AddUser(chatHub, UserNameId[i].ConnectionId, UserNameId[i].UserName, UserNameId[i].UserNameId, UserNameId[i].Sites, UserNameId[i].States, UserNameId[i].Img, UserNameId[i].ServerTime, UserNameId[i].Desg, UserNameId[i].status, UserNameId[i].PendingMSg);
                    }
                }
                
                // On User Disconnected
                chatHub.client.onUserDisconnected = function (id, userArray) {//, Loginuid,Profimage,dbserverTime,Sites,States) {
                    //  alert('ddd');
                    
                    $('#' + id).remove();
                    var ctrId = 'private_' + id;
                    $('#' + ctrId).remove();

                    if (($("#Toid").val()) == userArray.UserNameId) {
                        fnRemoveGif();
                        
                        //$('#myModal').modal('show');
                        $("#chatdet").html("");
                        $("#MsgContent").html(""); 
                       // fnLoadGifMsg();                       
                        //  $("#Toid").val("");
                        
                        $("#group").removeClass("tab-pane");
                        $("#group").addClass("tab-pane active");
                        $("#intividuals").removeClass("tab-pane active");
                        $("#intividuals").addClass("tab-pane");
                        $("#indiv").removeClass("active");
                        $("#offline").addClass("active");
                        //   alert(userArray.UserNameId);
                        $("#hdnofflineIdn").val("0");
                        $("#btnLoadonlyOfflineuser").click();
                        //fnRemoveGifMsg();

                    }
                   
                        $('#divusers').html("");
                        // AddUser(chatHub, id, name);

                        if(userArray.length==1){
                            var code="";
                            code = $(' <li>' +                                         
                                '<div style="padding-top:15px;" id="no-group">'+
                                                '<p style="font-size:25px; margin:10px 0px 0px 0px; color:#3f606f;"></p>'+
                                                '<p>No online users.</p>'+
                                            '</div>'+
                                                  '</li>');
                            $("#divusers").append(code);
                        }
                        else{


                            for (i = 0; i < userArray.length; i++) {
                                AddUser(chatHub, userArray[i].ConnectionId, userArray[i].UserName, userArray[i].UserNameId, userArray[i].Sites, userArray[i].States, userArray[i].Img, userArray[i].ServerTime, userArray[i].Desg, userArray[i].status, userArray[i].PendingMSg);
                            }
                        }

                 

                }
                var valuesP;
                chatHub.client.sendPrivateMessage = function (windowId, fromUserName, message, fromuserid, attach, url) {
                    var hdUserName = $('#hdUserName').val();
                    var ctrId = 'private_' + windowId;
                    var toid = $("#Toid").val();
                    if (message == "|") {
                        if (hdUserName != fromUserName)
                        {
                            //if (  $('#' + ctrId).find("#divMessage").find("#loadingPmy").length) {
                            //}
                            //else {
                            //    //$('#' + ctrId).find('#divMessage').append('<div id="loadingPmy" class="chatter" style="display:none;"><table class="chatter-tbl"><tr> <td class="pro-pic">' +
                            //    //                       '<img class="img-responsive img-circle"  src="' + imgg + '' + fromuserid + '.jpg"   onerror="this.src=' + "'" + profDefault + "'" + ';" />' +
                            //    //                       '</td><td><div class="chat-div"> <img src="' + imgurl + '/content/img/typing.gif" />' +
                            //    //                        '</div></td></tr> </table></div>');
                            //}
                    //    }
                    //else
                  //  {
                            if (  $('#' + ctrId).find("#divMessage").find("#loadingP").length <= 0){
                                $('#' + ctrId).find('#divMessage').append('<div id="loadingP" class="chatter"><table class="chatter-tbl"><tr> <td class="pro-pic">' +
                                                       '<img class="img-responsive img-circle"  src="' + imgg + '' + toid + '.jpg"   onerror="this.src=' + "'" + profDefault + "'" + ';" />' +
                                                       '</td><td><div class="chat-div"> <img src="' + imgurl + '/content/img/typing.gif" />' +
                                                        '</div></td></tr> </table></div>');
                            }
                        }
                    }

                    else if (message == "||") {
                       
                        // alert('sdddd');
                          if (hdUserName != fromUserName) 
                        {
                        //    if ( $('#' + ctrId).find("#divMessage").find("#loadingPmy").length) {
                        //        try {  $('#' + ctrId).find("#divMessage").find("#loadingPmy").remove(); } catch (err) { }
                        //    }
                        //}
                        //else
                       // {
                            //  alert('dd');
                           // if ( $('#' + ctrId).find("#divMessage").find("#loadingP").length > 0) {
                                try {  $('#' + ctrId).find("#divMessage").find("#loadingP").remove(); } catch (err) { }
                           // }
                        }
                    }
                    else {
                        if (hdUserName == fromUserName) {

                            if (message != "") {
                                $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td align="right">' +
                                                                           '<div class="chat-div-me"><p>' + message + '</p></div> </td> <td align="center" class="pro-pic">' +
                                                                           '<img class="img-responsive img-circle" src="' + imgg + fromuserid + '.jpg"  onerror="this.src=' + "'" + profDefault + "'" + ';"  /></td> </tr></table> </div>');

                            }
                            else if (attach != "0" || attach != "") {
                                $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td align="right">' +
                                                                               '<div class="chat-div-me"><a  target="_blank" style="cursor:pointer;" href="' + url + '">' + attach + '</a></div> </td> <td align="center" class="pro-pic">' +
                                                                               '<img class="img-responsive img-circle" src="' + imgg + fromuserid + '.jpg"  onerror="this.src=' + "'" + profDefault + "'" + ';"  /></td> </tr></table> </div>');

                            }

                            //if ( $('#' + ctrId).find("#divMessage").find("#loadingP").length > 0) {
                            //    try {  $('#' + ctrId).find("#divMessage").find("#loadingP").remove(); } catch (err) { }
                            //}
                        }
                        else {

                            if (message != "") {
                                $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td class="pro-pic" ><img class="img-responsive img-circle" src="' + imgg + toid + '.jpg"   onerror="this.src=' + "'" + profDefault + "'" + ';" /></td>' +
                                                                            '<td><div class="chat-div"><p>' + message + '</p></div> </td> ' +
                                                                            ' </tr></table> </div>');

                            }
                            else if (attach != "0" || attach != "") {
                                $('#' + ctrId).find('#divMessage').append('<div class="chatter"> <table class="chatter-tbl"> <tr> <td  class="pro-pic"><img class="img-responsive img-circle" src="' + imgg + toid + '.jpg"  onerror="this.src=' + "'" + profDefault + "'" + ';" /></td> ' +
                                                                               '<td><div class="chat-div"><a  target="_blank" style="cursor:pointer;" href="' + url + '">' + attach + '</a></div> </td> ' +
                                                                               '</tr></table> </div>');

                            }

                            //if ( $('#' + ctrId).find("#divMessage").find("#loadingP").length > 0) {
                            //    try {  $('#' + ctrId).find("#divMessage").find("#loadingP").remove(); } catch (err) { }
                            //}

                        }
                        $('#' + ctrId).find("#divMessage").find("#loadingP").remove();
                    }
                    // set scrollbar
                    var height = $("#divMessage").height();
                    $('div.chat-wrapper').scrollTop(height);
                  
                    fnRemoveGif();
                }

                chatHub.client.displayNotification = function (message,touserid,fromuserid,fromUserName,attach) {
                    debugger;
                    var Loginuid = "@ViewBag.Id";
                    if($("#Toid").val()!=fromuserid) {  // && Loginuid==touserid
                        if(message!=""){
                            toastr["success"]("<div><span>"+fromUserName+" says:</span><br /><br /><span>"+message+"</span></div>");
                        }
                        else{                            
                            toastr["success"]("<div><span>"+fromUserName+" says:</span><br /><br /><span>"+attach+"</span></div>");
                        }
                        // $("#"+logid+"newmsg").text("");

                        var i = parseInt($("#"+fromuserid+"newmsg").text()==""?"0":$("#"+fromuserid+"newmsg").text());
                        $("#"+fromuserid+"newmsg").text(i+1);
                        //   }
                    }
                    else{
                        $scope.FDataServer("1");
                    }
                };

                window.notifyApp = {
                    hubConnector: $.connection.hub.start()  //start the connection and store object returned globally for access in child views
                };



                function usrArrayadd(){
                    if($scope.GetOfflineUserArray!=null){
                        if($scope.GetOfflineUserArray.length!=null || $scope.GetOfflineUserArray.length!="" || $scope.GetOfflineUserArray.length!=0){
                            var name,id,site,emimg,dsg,penMsg="";
                            //    var status="0";
                            for (i = 0; i < $scope.GetOfflineUserArray.length; i++) {
                                name = $scope.GetOfflineUserArray[i].Name;
                                id = $scope.GetOfflineUserArray[i].Id;
                                site = $scope.GetOfflineUserArray[i].Sites;
                                emimg = $scope.GetOfflineUserArray[i].EmpImage;
                                dsg = $scope.GetOfflineUserArray[i].DsgName;
                                penMsg = $scope.GetOfflineUserArray[i].MsgCount;

                                Offlineuser(chatHub, id,name,id,"","",imgg+emimg,"",dsg,"0",penMsg);
                                //  AddUser(chatHub,id,name,id,site=="" || site==null?"":  site.substring(0,20)+"..."  ,imgg+emimg, "@ViewBag.ServerTime",dsg, status,penMsg);
                            }
                        }
                    }
                }
                
                $('#btnLoadOfflineuser').click(function () {                   
                    $scope.FDataServer("1");    
                    $scope.GetOfflineUser("1");                 
                });
                $('#btnLoadonlyOfflineuser').click(function () {    
                    $scope.GetOfflineUser("1"); 
                    if($("#hdnofflineIdn").val()=="0"){
                        $("#divusersOffline").find("#"+$("#Toid").val()+"").click();
                    }
                });
                
              
                $('#btnSearchuser').click(function () {
                    if($("#hdnSearch").val()=="0" || $("#hdnSearch").val()==""){
                        return;
                    }

                    if ($('#' + $("#hdnControlId").val()) != "0" || $('#' + $("#hdnControlId").val()) != "") {
                        $('#' + $("#hdnControlId").val()).remove();
                        $('#' + $("#hdnControlId").val()).find('#divMessage').html("");
                        $("#hdnControlId").val("0");
                    }

                  //  if (userId != Connectionid)
                    $("#Toid").val($("#hdnSearch").val());
                    var onlineusr="0";
                    try{
                        if($scope.OnlineuserArray!=null || $scope.OnlineuserArray!="0"){
                            for (i = 0; i < $scope.OnlineuserArray.length; i++) {
                                if($scope.OnlineuserArray[i].UserNameId==$("#hdnSearch").val()){
                                    onlineusr="1";
                                    OpenPrivateChatWindow(chatHub,  $scope.OnlineuserArray[i].ConnectionId, $("#txtSearch").val(),  $("#hdnSearch").val(), "@ViewBag.Id", $scope.OnlineuserArray[i].Sites, $scope.OnlineuserArray[i].States, $scope.OnlineuserArray[i].Img, $scope.OnlineuserArray[i].ServerTime, $scope.OnlineuserArray[i].Desg, "1");

                                    $scope.GetChatDataServer("0", 'private_' + $scope.OnlineuserArray[i].ConnectionId);                            
                                    return;
                                }
                                else { }
                            }
                        }
                    }
                    catch(err){}
                    if(onlineusr=="0"){
                        OpenPrivateChatWindow(chatHub, $("#hdnSearch").val(), $("#txtSearch").val(),  $("#hdnSearch").val(), "@ViewBag.Id", "","", profDefault, "", "", "0");

                        $scope.GetChatDataServer("0", 'private_' + $("#hdnSearch").val());
                   
                    }
               });
            }

            function AddUser(chatHub, Connectionid, name, logid, Sites, States, img, svrtime, dsgname, status, newmsgtext) {

                var userId = $('#hdId').val();
                var hdUserName = $('#hdUserName').val();
                var code = "";
                var htmlstring = $("#divusers").text();
                if (htmlstring.includes(name)) { }
                else {

                    if (hdUserName != name) {
                        code = $(' <li id='+logid+'>' +
                                            '<table class="table list-tbl">' +
                                                '<tr>' +
                                                    '<td style="width:50px; position:relative;">' +
                                                        '<div class="st-active"></div>' +
                                                        '<img class="img-circle" style="width:50px; height:50px;" src="' + img + '"     onerror="this.src=' + "'" + profDefault + "'" + ';" />' +
                                                    '</td>' +
                                                    '<td valign="middle" align="left" style="position:relative;">' +
                                                        '<i class="time">' + svrtime + '</i>' +
                                                        '<p id="' + Connectionid + '">' + name + '</p>' +
                                                        '<i class="time"><span id="'+logid+'newmsg"  class="badge" style="color:White;background-color: #4CAF50;"></span></i>'+
                                                        '<span>' + (Sites == "0" ? "" : Sites) + '</span><span>' + (Sites == "0" ? "" : "|") + '</span><span>' + (States == "0" ? "" : States) + '</span>' +
                                                     '</td>' +
                                                  '</tr>' +
                                                '</table>' +
                                               '</li>');
                        $(code).click(function () {
                            fnLoadGif();
                            if ($('#' + $("#hdnControlId").val()) != "0" || $('#' + $("#hdnControlId").val()) != "") {
                                $('#' + $("#hdnControlId").val()).remove();
                                $('#' + $("#hdnControlId").val()).find('#divMessage').html("");
                                $("#hdnControlId").val("0");
                            }

                            if (userId != Connectionid)
                                $("#"+logid+"newmsg").text("");


                            $("#Frmid").val(@ViewBag.Id);
                                $("#Toid").val(logid);
                                $scope.GetChatDataServer("0", 'private_' + Connectionid);
                                $scope.FDataServer("1");
                            OpenPrivateChatWindow(chatHub, Connectionid, name, logid, Loginuid, Sites, States, img, svrtime, dsgname, status);

                        });

                        $("#divusers").append(code);
                    }
                }

            }



            function Offlineuser(chatHub,Connectionid, name, logid, Sites, States, img, svrtime, dsgname, status, newmsgtext) {
                debugger;
                var userId = $('#hdId').val();
                var hdUserName = $('#hdUserName').val();
                var code = "";
                var htmlstring = $("#divusers").text();
                var Offlinehtmlstring = $("#divusersOffline").text();
                if (htmlstring.includes(name)) { 
                    if(newmsgtext!="0"){
                        $("#"+logid+"newmsg").text(newmsgtext);
                    }
                }
                else {
                    if (hdUserName != name) {
                        code = $(' <li id='+logid+'>' +
                                            '<table class="table list-tbl">' +
                                                '<tr>' +
                                                    '<td style="width:50px; position:relative;">' +
                                                        '<div class="st-deactive"></div>' +
                                                        '<img class="img-circle" style="width:50px; height:50px;" src="' + img + '" onerror="this.src=' + "'" + profDefault + "'" + ';" />' +
                                                    '</td>' +
                                                    '<td valign="middle" align="left" style="position:relative;">' +
                                                        '<i class="time">' + svrtime + '</i>' +
                                                        '<p id="' + Connectionid + '">' + name + '</p>' +
                                                        '<i class="time"><span id="'+logid+'newmsg"  class="badge" style="color:White;background-color: #4CAF50;">'+(newmsgtext == "0" ? "" : newmsgtext)+'</span></i>'+
                                                       'offline'+
                                                     '</td>' +
                                                  '</tr>' +
                                                '</table>' +
                                               '</li>');
                        if(newmsgtext!="0" && $("#hdnNotify").val()=="0" && $("#idnotifyshow").val()=="0" ){
                            $("#hdnNotify").val(newmsgtext);
                            $("#spnNotification").css("display","block");
                        }
                        $(code).click(function () {
                            fnLoadGif();
                            if ($('#' + $("#hdnControlId").val()) != "0" || $('#' + $("#hdnControlId").val()) != "") {
                                $('#' + $("#hdnControlId").val()).remove();
                                $('#' + $("#hdnControlId").val()).find('#divMessage').html("");
                                $("#hdnControlId").val("0");
                            }
                           // if (userId != Connectionid)
                                $("#"+logid+"newmsg").text("");
                            $("#Frmid").val(@ViewBag.Id);
                            $("#Toid").val(logid);
                            $scope.GetChatDataServer("0", 'private_' + Connectionid);
                            $scope.FDataServer("1");
                            OpenPrivateChatWindow(chatHub, Connectionid, name, logid, Loginuid, Sites, States, img, svrtime, dsgname, status);
                        });
                        $("#divusersOffline").append(code);
                    }
                }

            }
            var values;
            var ctrId;

            //toid -receiver id... logguid- sender user id, sites-sender sites
            function OpenPrivateChatWindow(chatHub, Connectionid, userName, toid, logguid, sites, States, img, svrtime, dsgname, status) {
                //  function OpenPrivateChatWindow(chatHub, id, userName) {
                $("#chatdet").html("");
                ctrId = 'private_' + Connectionid;
                if(status=="0"){ //offline user

                    $("#chatdet").append('<div class="chat-pro">' +
                                            '<img class="status" src="' + imgurl + '/Content/img/close_icon.png" />' +
                                            '<img style="height:120px;width:140px;" class="img-circle img-responsive hvr-rotate" src="' + img + '"  onerror="this.src=' + "'" + profDefault + "'" + ';" />' +
                                        '</div>' +
                                        '<h4>' + userName + '</h4>' +
                                        '<p style="padding:5px;"> Offline <br />  </p>');

                }
                else{
                    $("#chatdet").append('<div class="chat-pro">' +
                                            '<img class="status" src="' + imgurl + '/Content/img/profile-tick.png" />' +
                                            '<img style="height:120px;width:140px;" class="img-circle img-responsive hvr-rotate" src="' + img + '" onerror="this.src=' + "'" + profDefault + "'" + ';"/>' +
                                        '</div>' +
                                        '<h4>' + userName + '</h4>' +
                                        '<p style="padding:5px;"> ' + dsgname + '<br />  ' + svrtime + '<br /> ' + (sites == "0" ? "" : sites) + '  <br />' + (States == "0" ? "" : States) + '</p>'
                    );
                }

                if ($('#' + ctrId).length > 0) return;

                createPrivateChatWindow(chatHub, Connectionid, ctrId, userName, toid, logguid,status);

            }

            function createPrivateChatWindow(chatHub, Connectionid, ctrId, userName, toid, logguid,status) {
                $("#hdnControlId").val(ctrId);
                var div = $(' <table id="' + ctrId + '" class="table-responsive i-table"><tr> <td style="width:100%; height:100%;">' +
                                    '<table class="in-table"> <tr> <td class="chat-container"> <div class="gap-wrapper"></div>' +
                                     '<div id="style-4" class="chat-wrapper">   <a href="#" id="btnMsgP" class="btn btn-default SaveButton" style="display:none; margin-left:0px !important;margin-top: 10px;    margin-bottom: 5px;width: 100%;background-color:#e8e5e3;">Load All Message</a> <div id="divMessage"></div> </div>' +
                                       '</td> </tr> </table> </td> </tr>  </table>' +
                        '<div class="chat-footer"> <table style="margin-top:16px; border:none;" class="table cha-tbl">' +
                                '<tr><td align="center" style="width:100px; padding:0px; border:none;">' +
                                ' <a href="#"><img  class="hvr-wobble-top" id="imgfileUploadP" src="' + imgurl + '/Content/img/attachment.png" /></a> </td>' +
                                ' <td style="padding:0px; border:none;"><input type="text" id="txtPrivateMessage" placeholder="Type your message..."   />' +
                                   '</td><td style="width:75px; padding:0px; border:none;">' +
                                   ' <a   ><img class="hvr-wobble-top" id="btnSendMessage" src="' + imgurl + '/Content/img/send.png" /></a>' +
                                   '<input type="file" id="fileUploadP" style="width:195px;display:none;" />' +
                            '<input id="btnUploadFileP" type="button" value="Upload File" style="display:none ;"  />' +
                            '<input id="browsefilenameP" type="text" style="display:none ;"  />' +
                            '<input id="txtFilenameP" type="text" class="textBox" style="display:none ;" />' +
                    '<input id="txtFilepathP" type="text" class="textBox" style="display:none ;" /> ' +
                                    '</td>  </tr></table></div> ');

                //$("#MsgContent").append(MsgContentData);   browsefilenameP
                var $div = $(div);
                // DELETE BUTTON IMAGE
                //$div.find('#imgDelete').click(function () {
                //    $('#' + ctrId).remove();
                //});
                $div.find('#btnMsgP').click(function () {
                    $scope.GetChatDataServer("1",ctrId);
                });                


                // Send Button event
                $div.find("#btnSendMessage").click(function () {
                  //  fnLoadGif();
                    $("#Frmid").val(logguid);
                    $("#Toid").val(toid);
                    $textBox = $div.find("#txtPrivateMessage");
                    var msg = $textBox.val();
                    if (msg.length > 0) {
                        var data = new FormData();
                        try{
                            chatHub.server.sendPrivateMessage(Connectionid, $textBox.val(), toid, logguid, "", "0", "@ViewBag.Id", "");                          
                        }
                        catch(err){  }
                        if(status=="0")
                        {    // 
                            var htmlstring = $("#divusers").text();
                            if (htmlstring.includes(userName)) {
                                fnLoadGifMsg();
                               // $("#indiv").click();
                                $("#intividuals").removeClass("tab-pane");
                                $("#intividuals").addClass("tab-pane active");
                                $("#group").removeClass("tab-pane active");
                                $("#group").addClass("tab-pane");
                                $("#offline").removeClass("active");
                                $("#indiv").addClass("active");
                                $("#hdnofflineIdn").val("1");
                                $("#btnLoadonlyOfflineuser").click();
                                $("#divusers").find("#"+toid+"").click();
                                
                                fnRemoveGifMsg();
                            }
                            else {   
                                $scope.GetChatDataServer("0",'private_'+Connectionid);
                            }
                            
                        }       
                        //else{
                        //    var htmlstring = $("#divusersOffline").text();
                        //    if (htmlstring.includes(userName)) {
                        //        // offline user click
                        //        fnLoadGifMsg();                       
                        //        $("#Toid").val("");
                        //        $("#group").removeClass("tab-pane");
                        //        $("#group").addClass("tab-pane active");
                        //        $("#intividuals").removeClass("tab-pane active");
                        //        $("#intividuals").addClass("tab-pane");
                        //        $("#indiv").removeClass("active");
                        //        $("#offline").addClass("active");
                        //        $("#btnLoadonlyOfflineuser").click();
                        //        $("#divusersOffline").find("#"+toid+"").click();
                        //        fnRemoveGifMsg();
                        //    }
                        //    else {   
                        //    }

                        //}
                        $textBox.val('');
                      //  fnRemoveGif();
                    }
                    else {
                        var data = new FormData();
                        var files = $("#fileUploadP").get(0).files;

                        // Add the uploaded image content to the form data collection
                        if (files.length > 0) {
                            data.append("UploadedImage", files[0]);
                            fileval = "1";
                        }
                        else { fileval = "0"; }
                        if (fileval == "1") {
                            var ajaxRequest = $.ajax({
                                type: "POST",
                                url: apiurl,
                                contentType: false,
                                processData: false,
                                data: data
                            });

                            ajaxRequest.done(function (responseData, textStatus) {
                                if (textStatus == 'success') {
                                    if (responseData != null) {
                                        if (responseData.Key) {
                                            try{
                                                chatHub.server.sendPrivateMessage(Connectionid, $("#txtPrivateMessage").val(), toid, logguid, $("#browsefilenameP").val(), "0", "@ViewBag.Id", responseData.Value);
                                            }          
                                            catch(err){  }

                                            // chatHub.server.sendPrivateMessage(userId, "||", toid, logguid,"0","0","@ViewBag.Id","");
                                            $textBox.val('');
                                            fileval = "0";
                                            $("#fileUploadP").val('');
                                            if(status=="0")
                                            {
                                                fnLoadGifMsg();
                                                var htmlstring = $("#divusers").text();
                                                if (htmlstring.includes(userName)) {
                                                    $("#intividuals").removeClass("tab-pane");
                                                    $("#intividuals").addClass("tab-pane active");
                                                    $("#group").removeClass("tab-pane active");
                                                    $("#group").addClass("tab-pane");
                                                    $("#offline").removeClass("active");
                                                    $("#indiv").addClass("active");
                                                    // $("#"+Connectionid+"").click();
                                                    $("#hdnofflineIdn").val("1");
                                                    $("#btnLoadonlyOfflineuser").click();
                                                    $("#divusers").find("#"+toid+"").click();
                                                }
                                                else {                            
                                                    $scope.GetChatDataServer("0",'private_'+Connectionid);
                                                }
                                                fnRemoveGifMsg();
                                            }
                                            
                                            //else{
                                            //    var htmlstring = $("#divusersOffline").text();
                                            //    if (htmlstring.includes(userName)) {
                                            //        // offline user click
                                            //        fnLoadGifMsg();                       
                                            //        $("#Toid").val("");
                                            //        $("#group").removeClass("tab-pane");
                                            //        $("#group").addClass("tab-pane active");
                                            //        $("#intividuals").removeClass("tab-pane active");
                                            //        $("#intividuals").addClass("tab-pane");
                                            //        $("#indiv").removeClass("active");
                                            //        $("#offline").addClass("active");
                                            //        $("#btnLoadonlyOfflineuser").click();
                                            //        $("#divusersOffline").find("#"+toid+"").click();
                                            //        fnRemoveGifMsg();
                                            //    }
                                            //    else {   
                                            //    }

                                            //}

                                        } else {
                                            alert(responseData.Value);
                                            fnRemoveGif();
                                        }
                                    }
                                } else {
                                    alert(responseData.Value);
                                    fnRemoveGif();
                                }
                            });
                        }
                        else {
                            //alert('Ensure message or file');
                            $textBox.focus();
                            return;
                        }

                    }
                });          


                //Attach button
                $div.find('#imgfileUploadP').click(function () {
                    $div.find("#fileUploadP").click();

                    $("#fileUploadP").change(function () {
                        try {
                            fnLoadGif();
                            var filename = $("#fileUploadP").val();
                            if (navigator.userAgent.indexOf("Firefox") > -1) {
                                $("#browsefilenameP").val(filename);
                                $("#btnSendMessage").click();
                                $("#fileUploadP").val('');
                            }
                            else {
                                var lastIndex = filename.lastIndexOf("\\");
                                if (lastIndex >= 0) {
                                    filename = filename.substring(lastIndex + 1);

                                    $("#browsefilenameP").val(filename);
                                    $("#btnSendMessage").click();
                                    $("#fileUploadP").val('');
                                }
                            }
                        } catch (err) { fnRemoveGif(); }

                    });
                });           

                $div.find("#txtPrivateMessage").blur(function() {                    
                    chatHub.server.sendPrivateMessage(Connectionid, "||", toid, logguid,"0","0","@ViewBag.Id","");
                });
                $div.find("#txtPrivateMessage").keyup(function (e) {   
                    if (e.which == 13) {                       
                        $div.find("#btnSendMessage").click();
                    }
                    else{

                        var userName = $('#hdUserName').val();
                        if ($("#divMessage").find("#loadingP").length <= 0) {
                            chatHub.server.sendPrivateMessage(Connectionid, "|", toid, logguid,"0","0","@ViewBag.Id","");
                        }
                  }    
                   
                });

                AddDivToContainer($div);         

            }

            function AddDivToContainer($div) {
                $('#MsgContent').append($div);
                fnRemoveGif();
                $('#txtPrivateMessage').focus();                
            }

            $('#profImg').click(function () {
                $('#myModalProfImg').modal('show');
            });
         

            

            $('#spnNotification').click(function () {
                if( $("#hdnNotify").val()=="0"){
                   // toastr["success"]("No Notification yet!");
                    $('#spnNotification').css("display","none");
                }
                else{
                    $("#intividuals").removeClass("tab-pane active");
                    $("#intividuals").addClass("tab-pane");
                    $("#group").removeClass("tab-pane");
                    $("#group").addClass("tab-pane active");
                    $("#indiv").removeClass("active");
                    $("#offline").addClass("active");
                    $("#hdnNotify").val("0");
                    $('#spnNotification').css("display","none");
                    $scope.FDataServer("1");
                }
            });


        });
        @*</script>
    <script type="text/javascript">*@
        $(document).ready(function () {
            $('#divChatWindow').val('');
            fnRemoveGif();
            fnRemoveGifMsg();
            if( $("#hdnNotify").val()=="0"){
                $('#spnNotification').css("display","none");
            }
            else {
                $('#spnNotification').css("display","block");
            }        
            var img = $('#spnNotification'); var interval = window.setInterval(function()
            {
                if(img.css('display') == 'none')
                {
                    if( $("#hdnNotify").val()!="0")   img.css('display', 'block');
                }
                else
                {
                    img.css('display', 'none');
                }
            }, 500);

        });  
        
        function clearDivMSg(){
            $("#idnotifyshow").val("1");
            //alert('aaa');        
            if ($('#' + $("#hdnControlId").val()) != "0" || $('#' + $("#hdnControlId").val()) != "") {
                $('#' + $("#hdnControlId").val()).remove();
                $('#' + $("#hdnControlId").val()).find('#divMessage').html("");
                $("#hdnControlId").val("0");
            }            
            $("#Toid").val("");
                $("#chatdet").html("");
                $("#MsgContent").html("");
                $("#btnLoadOfflineuser").click(); 
                //   $("#spnNotification").click();
                $("#hdnNotify").val("0");
                $('#spnNotification'). css('display', 'none');
          
        }
     
    </script>
    <script type="text/javascript">
        var EmpImageUploadUrl = "@Url.Action("EmpImageUpload", "Chat")";
        var SetChatUrl = "@Url.Action("SetChat", "Chat")";
        var GetChatUrl = "@Url.Action("Getchat", "Chat")";
        var GetUserUrl = "@Url.Action("GetUser", "Chat")";

    </script>
</head>
<body style="background:#f4f7fb; overflow:hidden;" ng-app="CIRModule" ng-controller="Chat_OperController">
    @*<div id="divContainer">*@
    <div id="divChatWindow">    </div>
    <div id="divLoading" style="position: absolute; height: 100%; width: 100%; z-index: 1000; background-color:whitesmoke;">
        <div style="margin: auto;">
            <img src="~/Content/img/circle-simple_light.gif" style="margin-left: 40%; margin-top: 20%;" />
        </div>
    </div>
    <div style="padding-left:0px;" id="wrapper">

        @*<div id="alert-placeholder" style="padding: 5px;"></div>*@
        <!-- Page Content -->
        <div class="row m-header">
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-6 pad-0">
                        <a href="#menu-toggle" class="" id="menu-toggle">
                            <img style="margin-left:0px;" src="~/Content/img/logo-chat.jpg" />
                        </a>

                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 pad-0">
                        <div class="h-rigt-div">
                            <table align="right" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td style=" width:65px;">
                                        
                                        @*<a href="#"><span style="height:50px;" class="label label-danger">5</span></a>*@
                                    </td>
                                    <td style="border-left:1px #efa64f solid;">
                                        <a href="@Url.Action("Index", "Dashboard")"><img style="height:40px;" src="~/Content/img/home.png" /></a>
                                    </td>
                                    <td style="border-left:1px #efa64f solid;">
                                        <a href="~/Login"><img style="height:50px;" src="~/Content/img/logout.png" /></a>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="m-wrapper">
            <table class="table-responsive tbl-chat">
                <tr>
                    <td align="center" valign="top" class="left-col">
                        <div class="me-pro">
                            <table class="table">
                                <tr>
                                    <td style="width:80px; height:65px; padding:0px; border:0px;">
                                        <div class="pro-photo">
                                            <img class="img-responsive img-circle" src="@ViewBag.Title" onerror="this.src='/gamesacir/Content/img/default-profile.png';" id="profImg" title="Change image" style="cursor:pointer; width:50px; height:50px; " /> 
                                            <form id="uploadform">
                                                <input type="file" style="padding:0px; display:none ;" id="fuImage" name="fuImage" class="clsfuImage" />
                                            </form>
                                            <input type="button" ng-click="FDatagetUser(1)" style="display:none;" id="btnNotify" />
                                            <input type="button" style="display:none;" id="btnLoadOfflineuser" />
                                            <input type="button" style="display:none;" id="btnLoadonlyOfflineuser" />
                                            <input type="hidden" id="hdnofflineIdn" value="0"/>
                                            <input type="button" style="display:none;" id="btnGetuserUpdate" />
                                            <input type="hidden" id="idnotifyshow" style="display:none ;" value="0" />
                                            <input type="text" ng-model="chatid" id="chatid" style="display:none ;" />
                                            <input type="text" ng-model="Frmid" id="Frmid" style="display:none ;" />
                                            <input type="text" ng-model="Toid" id="Toid" style="display:none ;" />
                                            <input type="text" ng-model="chatMsg" id="chatMsg" style="display:none ;" />
                                            <input type="text" ng-model="chatAttach" id="chatAttach" style="display:none ;" />
                                        </div>
                                    </td>
                                    <td valign="middle" style="padding:0px; vertical-align:middle; border:0px;">
                                        <p>Hi! <span id='spanUser'></span></p>
                                        <span style="font-size:10px;"> @(ViewBag.Site == "0" ? "" : ViewBag.Site) </span>
                                        <span style="font-size:10px;"> @(ViewBag.Site == "0" ? "" : "|")</span>
                                        <span style="font-size:10px;"> @(ViewBag.State == "0" ? "" : ViewBag.State) </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="search-pro">
                            <div class="search-div">
                                <table class="tbl-search">
                                    <tr>
                                        <td>
                                            <input type="hidden" value="0" id="hdnSearch" />
                                            <input type="text" placeholder="Profile search" id="txtSearch" />                                       
                                            
                                        </td>
                                        <td>
                                            <a href="#"><img class="hvr-wobble-top" src="~/Content/img/search-icon.png"  id="btnSearchuser"/></a>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div id="style-4" class="pro-list">
                            <div>
                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs" role="tablist"> 
                                    <li role="presentation" onclick="clearDivMSg()" id="indiv" class="active"><a href="#intividuals"  aria-controls="home" role="tab" data-toggle="tab">Chat</a></li>
                                    <li  role="presentation"  onclick="clearDivMSg()" id="offline">                                     
                                            <a href="#group" aria-controls="profile" role="tab" data-toggle="tab">Offline User</a>
                                        <span id="spnNotification">
                                            <i class="glyphicon glyphicon-bell pull-right" style="cursor:pointer;  margin-top:-30px; font-size: 20px;color: #e21616;margin-right: -15px;"></i>
                                        </span>
                                       
                                    </li>
                                </ul>
                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div role="tabpanel" class="tab-pane active" id="intividuals">
                                        <ul class="pro-list-ul">
                                            <div id="divusers"></div>
                                        </ul>
                                    </div>
                                    <div  role="tabpanel" class="tab-pane" id="group">
                                        <ul class="pro-list-ul">
                                            <div id="divusersOffline"></div>
                                        </ul>

                                        @*<div style="padding-top:15px;" id="no-group">
                                            <a href="#"><img class="hvr-bounce-out" src="~/Content/img/create-groups.png" /></a>
                                            <p style="font-size:25px; margin:10px 0px 0px 0px; color:#3f606f;">Create Group</p>
                                            <p>All user</p>
                                        </div>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                    <!--Content Part Start Here-->
                    <td class="right-col">
                        <div id="divLoadingMsg" style="position: absolute; height: 100%; width: 100%; z-index: 1000; background-color:whitesmoke;">
                            <div style="margin: auto;">
                                <img src="~/Content/img/circle-simple_light.gif" style="margin-left: 40%; margin-top: 20%;" />
                            </div>
                        </div>
                        <div id="MsgContent"></div>
                    </td><!--Content Part Start Here-->
                    <td align="center" valign="top" class="chat-profile">
                        <br />
                        <br/>
                        <br /><br /><br />
                        <div id="chatdet"></div>
                    </td>
                </tr>
            </table>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <input id="txtNickName" type="text" class="textBox" value="@ViewBag.Name" style="display:none ;" />
    <input id="txtUrl" type="text" class="textBox" value="@ViewBag.Title" style="display:none ;" />
    <input id="txtFilename" type="text" class="textBox" style="display:none ;" />  @*//value="@ViewBag.Id"*@
    <input id="txtFilepath" type="text" class="textBox" style="display:none ;" />
    <input id="hdId" type="hidden" />
    <input id="hdUserName" type="hidden" />
    <input id="hdnControlId" type="hidden" />
    <input id="hdnNotify" type="hidden" value="0" />

    <div style="top:15%;" id="myModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
        <div class="modal-dialog modal-sm" style="width:230px;" role="document">
            <div style="border-radius:0px;" class="modal-content">
                <table align="center">
                    <tr>
                        <td align="center" valign="middle" style="padding-top:20px;">
                            @*<div class="modal-header">
                                    <a class="cxslose" data-dismiss="modal">×</a>
                                    <h3>Modal header</h3>
                                </div>*@
                            <div class="modal-body">
                                <p>User Disconnected…</p>
                            </div>
                            <div class="modal-footer" style="margin-left: -35px;margin-right: -35px;">
                                <a href="#" class="btn btn-primary pull-right" data-dismiss="modal">Ok</a>
                                @*<a href="#" class="btn btn-primary">Save changes</a>*@
                            </div>
                        </td>
                    </tr>

                </table>
            </div>
        </div>
    </div>

    <div style="top:15%;" id="myModalProfImg" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div style="border-radius:0px; padding:45px 0px;" class="modal-content">
                <table align="center">
                    <tr>
                        <td align="center" valign="middle" style="width:200px; height:200px; background:#f2fffe; border:1px rgba(59, 59, 59, 0.66) dashed;">
                            <div id="dvup1">
                                <a href="#">
                                    <img src="~/Content/img/upload.png" ng-click="imggupload()" />
                                </a>
                                <p>upload photo</p>
                            </div>
                            <div id="dvup2" style="display:none;">
                                <p>uploading...</p>
                            </div>
                            <div id="dvup3" style="display:none;">
                                <img src="~/Content/img/profile-tick.png" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @*<a href="#" id="btnuploadpop" class="btn btn-default SaveButton" style="display:none; margin-left:0px !important;margin-top: 10px;width: 100%;background-color:#f08002;"    ng-click="FUpload()">Upload</a>*@

                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    @*</div>*@
    <!-- /#wrapper -->
    <!-- jQuery -->
    @*<script src="~/Scripts/jquery.js"></script>*@
    <!-- Bootstrap Core JavaScript -->
    <script src="~/Scripts/bootstrap.min.js"></script>
    <!-- Menu Toggle Script -->
    <script type="text/javascript">


        $(".clsfuImage").on('change', function (e) {
            var iframe = $('<iframe name="postiframe1" id="postiframe1" style="display: none"></iframe>');
            $("body").append(iframe);
            var form = $('#uploadform');
            form.attr("action", "@Url.Action("FileUploadprofile", "Chat")");
            form.attr("method", "post");
            form.attr("encoding", "multipart/form-data");
            form.attr("enctype", "multipart/form-data");
            form.attr("target", "postiframe1");
            form.attr("file", $('#fuImage').val());
            form.submit();
            $("#dvup1").css("display", "none");
            $("#dvup2").css("display", "none");
            $("#dvup3").css("display", "block");

            $("#proffphoto").src = imgg + $("#fuImage").val();
            location.reload();
        });

        
      
        var ProfilesearchViewType = @System.Configuration.ConfigurationManager.AppSettings["ProfilesearchViewType"].ToString();
        $("#txtSearch").keyup(function (e) {
            if (e.which == 13) {
                $('#btnSearchuser').click();
              //  $("#hdnSearch").val("0");
             //   $("#txtSearch").val("");
            }
            if (e.which == 46 || e.which == 8  ) { //keycode 8-backspace 46-delete
                  $("#hdnSearch").val("0");
                   $("#txtSearch").val("");
            }
            var Data = {
                txt: $("#txtSearch").val(),
                refId: "0",
                viewType: ProfilesearchViewType
            };

            $("#txtSearch").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "@Url.Action("GetSearchDetails", "CIR")",
                        data: JSON.stringify(Data),
                    dataType: "json",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {

                        response($.map(data, function (item) {
                            return {
                                label: item.TextValue,
                                val: item.Id
                            }
                        }))
                    },
                    error: function (response) {

                    },
                    failure: function (respose) {

                    }
                });
        },
            minlength: 1,
            select: function (e, i) {
            $("#hdnSearch").val(i.item.val);
            $("#txtSearch").val(i.item.label);
          //  alert($("#hdnSearch").val()+"----"+$("#txtSearch").val());
            $('#btnSearchuser').click();
           // $("#hdnSearch").val("0");
            //$("#txtSearch").val("");
        }
        });
        });

        
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": false,
            "progressBar": true,
            "positionClass": "toast-bottom-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }
    </script>
</body>
</html>